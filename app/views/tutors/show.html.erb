<% full_name = [@tutor.learner&.first_name, @tutor.learner&.last_name].compact.join(' ') %>

<div class="row">
  <div class="col-12">
    <h1 class="display-5 mb-4"><%= full_name.presence || 'Tutor' %></h1>

    <div class="row">
      <div class="col-md-8">
        <div class="card mb-4">
          <div class="card-body">
            <h2 class="card-title h4 mb-3">Details</h2>
            
            <% if @tutor.bio.present? %>
              <p class="card-text"><strong>Bio:</strong> <%= @tutor.bio %></p>
            <% else %>
              <p class="card-text text-muted">No bio has been provided.</p>
            <% end %>
            <p class="card-text">
              <strong>Rating:</strong>
              <% avg = @tutor.average_rating %>
              <% count = @tutor.reviews_count %>
              
              <% if count > 0 %>
                <span class="badge bg-warning text-dark ms-2">
                  ‚≠ê <%= sprintf("%.1f", avg) %>
                  <small>(<%= count %> reviews)</small>
                </span>
              <% else %>
                <span class="text-muted ms-2">No reviews yet</span>
              <% end %>
            </p>

          </div>
        </div>
      </div>
    </div>

    <% subjects =
         if @tutor.respond_to?(:subjects)
           @tutor.subjects
         else
           Teach.where(tutor_id: @tutor.id).includes(:subject).map(&:subject)
         end %>

    <% if subjects.present? %>
      <div class="card">
        <div class="card-body">
          <h2 class="card-title h4 mb-3">Subjects</h2>
          <div class="d-flex flex-wrap gap-2">
            <% subjects.each do |s| %>
              <span class="badge bg-primary badge-custom"><%= s.name %></span>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>